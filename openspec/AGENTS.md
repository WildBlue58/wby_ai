# OpenSpec 工作流程指南

本文档为 AI 助手提供在此项目中工作的标准化流程和规范。

## 何时创建变更提案

在以下情况下，AI 助手应创建变更提案（Change Proposal）：

### 必须创建提案的场景

1. **架构性变更**
   - 添加新的技术栈或框架
   - 重构现有目录结构
   - 引入新的开发工具或构建系统

2. **重大功能模块**
   - 添加新的学习主题模块（如新建 `webgl/` 目录）
   - 创建跨多个文件的综合示例
   - 引入新的 AI 集成方案

3. **规范性变更**
   - 修改项目编码约定
   - 更新文档结构标准
   - 调整命名规范

### 可以直接实施的场景

1. **单个示例的修改**
   - 修复现有代码的 bug
   - 优化单个示例的性能
   - 更新示例的注释和文档

2. **文档更新**
   - 完善已有 README
   - 添加代码注释
   - 修正拼写错误

3. **小型新增**
   - 在现有目录下添加新的示例文件
   - 补充现有主题的练习题

## 变更提案流程

### 1. 创建提案

在 `openspec/changes/` 目录下创建新提案：

**文件命名格式**：`YYYYMMDD-feature-name.md`

- 示例：`20241021-add-webgl-module.md`

**提案模板**：

```markdown
---
status: draft
created: YYYY-MM-DD
author: AI Assistant (with User)
---

# [提案标题]

## 背景与动机

为什么需要这个变更？解决什么问题？

## 目标

这个变更要达到什么效果？

## 技术方案

### 变更概览
- 涉及的文件和目录
- 技术栈选择

### 实施细节
1. 步骤一
2. 步骤二
3. ...

### 代码示例（如适用）
\```javascript
// 示例代码
\```

## 影响范围

- 新增的文件/目录
- 修改的现有文件
- 可能的依赖变更

## 风险评估

- 潜在问题
- 缓解措施

## 替代方案

是否考虑过其他实现方式？为何选择当前方案？

## 后续工作

实施后需要的跟进任务（如文档更新、示例补充等）
```

### 2. 提案状态管理

提案文件头部的 `status` 字段表示当前状态：

- **draft**：草稿，正在编写中
- **review**：提交给用户审核
- **approved**：用户已批准，可以实施
- **rejected**：用户拒绝，需要修改或放弃
- **implemented**：已实施完成
- **archived**：已归档（实施完成后移至 `archive/` 目录）

### 3. 实施提案

1. 用户批准提案后，更新状态为 `approved`
2. 按照提案的技术方案逐步实施
3. 实施过程中如有偏差，及时与用户沟通
4. 完成后更新状态为 `implemented`

### 4. 归档提案

实施完成一段时间后，将提案移至 `openspec/changes/archive/` 目录：

```bash
mv openspec/changes/20241021-add-webgl-module.md openspec/changes/archive/
```

## AI 协作指南

### 提案创建原则

1. **清晰性**：提案应明确说明变更内容和原因
2. **完整性**：包含所有必要的技术细节
3. **可评估性**：用户能够快速理解影响范围
4. **简洁性**：避免冗长，重点突出

### 与用户的协作模式

1. **主动提议**：
   - AI 发现改进机会时，主动创建提案
   - 示例："我注意到项目缺少 WebGL 示例，我创建了一个提案..."

2. **响应式实施**：
   - 用户提出需求时，评估是否需要提案
   - 小改动直接实施，大改动先写提案

3. **迭代优化**：
   - 提案被拒绝时，理解用户反馈
   - 修改提案或提出替代方案

### 特殊场景处理

**学习项目特性**：

- 本项目是学习笔记集合，示例间相对独立
- 新增单个学习示例通常不需要提案
- 但批量添加一系列相关示例时建议创建提案

**多技术栈并存**：

- 项目包含多种技术栈（React、Vue、Next.js 等）
- 确保新增内容符合对应技术栈的最佳实践
- 跨技术栈的通用规范变更需要提案

## 示例场景

### 场景 1：添加单个算法题解（无需提案）

用户："帮我添加一个二叉树遍历的示例"

AI 行动：

- 直接在 `interview/algorithm/` 下创建新目录
- 包含 `readme.md` 和示例代码
- 遵循现有结构和风格

### 场景 2：引入新技术栈（需要提案）

用户："我想学习 Three.js，帮我建立学习模块"

AI 行动：

1. 创建提案 `openspec/changes/YYYYMMDD-add-threejs-module.md`
2. 说明目录结构、学习路径、示例规划
3. 等待用户批准后实施

### 场景 3：重构目录结构（需要提案）

用户："interview 目录太乱了，帮我整理一下"

AI 行动：

1. 创建提案说明重构方案
2. 列出目录变更、文件移动
3. 评估影响范围
4. 获得批准后执行

## 提案评审标准

用户在审核提案时通常关注：

1. **必要性**：变更是否真的需要？
2. **清晰性**：技术方案是否清晰可行？
3. **影响范围**：会影响哪些现有内容？
4. **学习价值**：是否符合学习项目的定位？
5. **可维护性**：未来是否容易维护和扩展？

## 总结

OpenSpec 提案机制的核心目的是：

- ✅ 确保重要变更经过深思熟虑
- ✅ 保持项目结构的一致性和可维护性
- ✅ 让用户对项目演进有清晰的掌控
- ✅ 建立 AI-人类协作的高效模式

小改动快速实施，大改动深思熟虑。
